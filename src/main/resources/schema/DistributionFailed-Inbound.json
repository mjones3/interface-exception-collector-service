{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://schemas.biopro.arcone.com/events/DistributionFailed/v1.0.0",
  "title": "Distribution Failed Event",
  "description": "Event published when distribution processing fails",
  "type": "object",
  "required": [
    "eventId",
    "eventType",
    "eventVersion",
    "occurredOn",
    "source", 
    "payload"
  ],
  "properties": {
    "eventId": {
      "type": "string",
      "format": "uuid"
    },
    "eventType": {
      "type": "string",
      "const": "DistributionFailed"
    },
    "eventVersion": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+$"
    },
    "occurredOn": {
      "type": "string",
      "format": "date-time"
    },
    "source": {
      "type": "string",
      "const": "distribution-service"
    },
    "correlationId": {
      "type": "string",
      "format": "uuid"
    },
    "payload": {
      "type": "object",
      "required": [
        "transactionId",
        "distributionId",
        "operation",
        "failureReason"
      ],
      "properties": {
        "transactionId": {
          "type": "string",
          "format": "uuid"
        },
        "distributionId": {
          "type": "string",
          "description": "External distribution identifier"
        },
        "operation": {
          "type": "string",
          "enum": ["CREATE_DISTRIBUTION", "MODIFY_DISTRIBUTION"],
          "description": "Operation that failed"
        },
        "failureReason": {
          "type": "string",
          "description": "Human-readable failure reason"
        },
        "customerId": {
          "type": "string",
          "description": "Customer identifier"
        },
        "destinationLocation": {
          "type": "string",
          "description": "Destination location code"
        },
        "requestedProducts": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "productCode": {
                "type": "string"
              },
              "quantity": {
                "type": "integer"
              },
              "bloodType": {
                "type": "string"
              }
            }
          }
        },
        "errorCode": {
          "type": "string",
          "description": "Technical error code"
        }
      }
    }
  },
  "examples": [
    {
      "eventId": "550e8400-e29b-41d4-a716-446655440007",
      "eventType": "DistributionFailed",
      "eventVersion": "1.0", 
      "occurredOn": "2025-08-04T11:30:00Z",
      "source": "distribution-service",
      "payload": {
        "transactionId": "550e8400-e29b-41d4-a716-446655440008",
        "distributionId": "DIST-ABC123",
        "operation": "CREATE_DISTRIBUTION",
        "failureReason": "Insufficient inventory for requested products",
        "customerId": "CUST003",
        "destinationLocation": "LOC789",
        "requestedProducts": [
          {
            "productCode": "WB001",
            "quantity": 10,
            "bloodType": "A+"
          }
        ],
        "errorCode": "INVENTORY_SHORTAGE"
      }
    }
  ]
}
