{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://schemas.biopro.arcone.com/events/ExceptionRetryCompleted/v1.0.0", 
  "title": "Exception Retry Completed Event",
  "description": "Event published when a retry operation completes",
  "type": "object",
  "required": [
    "eventId",
    "eventType",
    "eventVersion",
    "occurredOn",
    "source",
    "payload"
  ],
  "properties": {
    "eventId": {
      "type": "string",
      "format": "uuid"
    },
    "eventType": {
      "type": "string",
      "const": "ExceptionRetryCompleted"
    },
    "eventVersion": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+$"
    },
    "occurredOn": {
      "type": "string",
      "format": "date-time"
    },
    "source": {
      "type": "string",
      "const": "exception-collector-service"
    },
    "correlationId": {
      "type": "string",
      "format": "uuid"
    },
    "payload": {
      "type": "object",
      "required": [
        "exceptionId",
        "transactionId",
        "attemptNumber",
        "retryStatus"
      ],
      "properties": {
        "exceptionId": {
          "type": "integer",
          "format": "int64"
        },
        "transactionId": {
          "type": "string",
          "format": "uuid"
        },
        "attemptNumber": {
          "type": "integer",
          "minimum": 1,
          "description": "Which retry attempt this was"
        },
        "retryStatus": {
          "type": "string",
          "enum": ["SUCCESS", "FAILED"],
          "description": "Result of the retry operation"
        },
        "retryResult": {
          "type": "object",
          "properties": {
            "success": {
              "type": "boolean"
            },
            "message": {
              "type": "string",
              "description": "Response message from target service"
            },
            "responseCode": {
              "type": "integer",
              "description": "HTTP response code"
            },
            "errorDetails": {
              "type": "object",
              "description": "Additional error information if retry failed"
            }
          }
        },
        "initiatedBy": {
          "type": "string",
          "description": "User or system that initiated the retry"
        },
        "targetService": {
          "type": "string",
          "enum": ["order-service", "collection-service", "distribution-service"],
          "description": "Service that processed the retry"
        },
        "completedAt": {
          "type": "string",
          "format": "date-time"
        },
        "processingTimeMs": {
          "type": "integer",
          "description": "Time taken to process retry in milliseconds"
        }
      }
    }
  },
  "examples": [
    {
      "eventId": "550e8400-e29b-41d4-a716-446655440012",
      "eventType": "ExceptionRetryCompleted",
      "eventVersion": "1.0",
      "occurredOn": "2025-08-04T14:15:30Z",
      "source": "exception-collector-service",
      "payload": {
        "exceptionId": 12346,
        "transactionId": "550e8400-e29b-41d4-a716-446655440013",
        "attemptNumber": 1,
        "retryStatus": "SUCCESS",
        "retryResult": {
          "success": true,
          "message": "Order processed successfully",
          "responseCode": 200
        },
        "initiatedBy": "user123",
        "targetService": "order-service",
        "completedAt": "2025-08-04T14:15:30Z",
        "processingTimeMs": 250
      }
    }
  ]
}
