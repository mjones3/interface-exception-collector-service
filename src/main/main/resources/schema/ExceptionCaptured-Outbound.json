{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://schemas.biopro.arcone.com/events/ExceptionCaptured/v1.0.0",
  "title": "Exception Captured Event",
  "description": "Event published when a new exception is captured and stored",
  "type": "object",
  "required": [
    "eventId",
    "eventType",
    "eventVersion",
    "occurredOn",
    "source",
    "payload"
  ],
  "properties": {
    "eventId": {
      "type": "string",
      "format": "uuid"
    },
    "eventType": {
      "type": "string",
      "const": "ExceptionCaptured"
    },
    "eventVersion": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+$"
    },
    "occurredOn": {
      "type": "string",
      "format": "date-time"
    },
    "source": {
      "type": "string",
      "const": "exception-collector-service"
    },
    "correlationId": {
      "type": "string",
      "format": "uuid"
    },
    "causationId": {
      "type": "string",
      "format": "uuid",
      "description": "ID of the original exception event that caused this"
    },
    "payload": {
      "type": "object",
      "required": [
        "exceptionId",
        "transactionId",
        "interfaceType",
        "severity",
        "category"
      ],
      "properties": {
        "exceptionId": {
          "type": "integer",
          "format": "int64",
          "description": "Unique exception ID in collector database"
        },
        "transactionId": {
          "type": "string",
          "format": "uuid",
          "description": "Original transaction ID"
        },
        "interfaceType": {
          "type": "string",
          "enum": ["ORDER", "COLLECTION", "DISTRIBUTION"],
          "description": "Type of interface that generated the exception"
        },
        "severity": {
          "type": "string",
          "enum": ["LOW", "MEDIUM", "HIGH", "CRITICAL"],
          "description": "Severity level assigned to the exception"
        },
        "category": {
          "type": "string",
          "enum": ["BUSINESS_RULE", "VALIDATION", "SYSTEM_ERROR", "INTEGRATION"],
          "description": "Category of the exception"
        },
        "exceptionReason": {
          "type": "string",
          "description": "Human-readable exception reason"
        },
        "customerId": {
          "type": "string",
          "description": "Customer identifier"
        },
        "externalId": {
          "type": "string",
          "description": "Customer's external reference ID"
        },
        "retryable": {
          "type": "boolean",
          "description": "Whether this exception can be retried"
        },
        "operation": {
          "type": "string",
          "description": "Operation that caused the exception"
        },
        "capturedAt": {
          "type": "string",
          "format": "date-time",
          "description": "When the exception was captured by collector"
        }
      }
    }
  },
  "examples": [
    {
      "eventId": "550e8400-e29b-41d4-a716-446655440011",
      "eventType": "ExceptionCaptured",
      "eventVersion": "1.0",
      "occurredOn": "2025-08-04T10:30:05Z",
      "source": "exception-collector-service",
      "correlationId": "550e8400-e29b-41d4-a716-446655440001",
      "causationId": "550e8400-e29b-41d4-a716-446655440000",
      "payload": {
        "exceptionId": 12345,
        "transactionId": "550e8400-e29b-41d4-a716-446655440002",
        "interfaceType": "ORDER",
        "severity": "MEDIUM",
        "category": "BUSINESS_RULE",
        "exceptionReason": "Order already exists for external ID ORDER-ABC123",
        "customerId": "CUST001",
        "externalId": "ORDER-ABC123",
        "retryable": false,
        "operation": "CREATE_ORDER",
        "capturedAt": "2025-08-04T10:30:05Z"
      }
    }
  ]
}
