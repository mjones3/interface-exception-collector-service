<div class="flex flex-col flex-auto">
    <rsa-process-header
      [subTitle]="header.subTitle | async"
      [title]="header.title | async"
    ></rsa-process-header>
    <div class="flex flex-col">
      <div class="flex flex-row space-x-4 w-full p-4">
        <div class="w-full overflow-hidden">
          <fuse-card class="flex-col pb-4">
            <div class="fuse-card-title">
              <div class="flex flex-row w-full justify-between px-5 items-baseline">
                <h3>Results</h3>
              </div>
            </div>
            <mat-divider></mat-divider>
            <div class="table-wrapper">
              <p-table
                #orderTable
                id="ordersTableId"
                dataKey="id"
                styleClass="p-datatable-customers p-datatable-sm"
                currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
                [value]="orders"
                [columns]="selectedColumns"
                [rows]="defaultRowsPerPage"
                [totalRecords]="totalRecords"
                [rowsPerPageOptions]="[10, 25, 50]"
                [showCurrentPageReport]="true"
                [paginator]="false"
                [loading]="loading"
                [lazy]="true"
                [sortField]="defaultSortField"
                (onLazyLoad)="fetchOrders($event)"
              >
                <ng-template pTemplate="header" let-columns>
                  <tr>
                    <th class="w-12"></th>
                    <th
                      [pSortableColumn]="col.sortable ? (col.sortFieldName ? col.sortFieldName : col.field) : null"
                      [ngClass]="col.headerCls"
                      *ngFor="let col of columns; let i = index"
                    >
                      <div class="flex items-center p-d-flex p-jc-between p-ai-center" *ngIf="!col.hideHeader">
                        {{ col.header }}
                        <p-sortIcon
                          [field]="col.sortFieldName ? col.sortFieldName : col.field"
                          *ngIf="col.sortable"
                        ></p-sortIcon>
                      </div>
                    </th>
                  </tr>
                </ng-template>
                <ng-template pTemplate="body" let-order let-expanded="expanded" let-columns="columns">
                  <tr>
                    <th class="w-12"></th>
                    <td *ngFor="let col of columns; let i = index" class="break-all">
                      <ng-template #dateTpl let-order let-field="field">
                        {{ order[field] | date: 'MM/dd/yyyy' }}
                      </ng-template>
                      <ng-template #actionTpl let-order>
                        <button
                          id="detailsBtn"
                          class="bg-custom-red justify-center"
                          mat-flat-button
                          (click)="details(order)"
                        >
                          Details
                        </button>
                      </ng-template>
                      <ng-template #statusTpl let-order>
                        <span class="badge status" [ngStyle]="{ 'background-color': order.statusColor }">
                          {{ order.statusDescriptionKey | uppercase }}
                        </span>
                      </ng-template>
  
                      <ng-container *ngIf="{ dateTpl: dateTpl, statusTpl: statusTpl, actionTpl: actionTpl } as templates">
                        <ng-container *ngIf="col?.templateRef">
                          <ng-container
                            *ngTemplateOutlet="
                              templates[col?.templateRef];
                              context: { $implicit: order, field: col?.field }
                            "
                          ></ng-container>
                        </ng-container>
                      </ng-container>
  
                      <ng-container *ngIf="!col?.templateRef">
                        {{ order[col.field]?.toString() | uppercase }}
                      </ng-container>
                    </td>
                  </tr>
                </ng-template>
                <ng-template pTemplate="rowexpansion" let-order>
                  <tr>
                    <td [attr.colspan]="selectedColumns?.length">
                      <div class="p-4">
                        <span class="font-bold mb-1 text-left mr-4 w-60"> Comments</span>
                        <span class="flex-auto text-left">{{ order?.comments | uppercase }}</span>
                      </div>
                    </td>
                  </tr>
                </ng-template>
              </p-table>
            </div>
          </fuse-card>
        </div>
      </div>
    </div>
  </div>