<div class="flex flex-auto flex-col space-y-1">
    <biopro-process-header
        [subTitle]="header.subTitle | async"
        [title]="header.title | async"
        [buttons]="actionButtonsTpl"
    ></biopro-process-header>

    <div class="flex w-full flex-row space-x-8 p-4">
        <div class="flex w-9/12 flex-auto flex-col space-y-3">
            <fuse-card class="flex flex-row items-center space-x-6 p-6">
                <div class="flex flex-row space-x-2">
                    <span class="text-left font-bold">Quantity:</span>
                    <span class="text-left font-bold">
                        <span
                            >(
                            <span id="filledProductsCountId"
                                >{{ filledProductsData?.length }}
                            </span>
                            of <span id="prodQtyId">{{ quantity }}</span
                            >)</span
                        >
                    </span>
                </div>
                <div class="flex flex-auto flex-col">
                    <mat-progress-bar
                        id="productsFilledProgressBar"
                        class="h-2"
                        mode="determinate"
                        [value]="
                            ((filledProductsData?.length || 0) / quantity) * 100
                        "
                    ></mat-progress-bar>
                </div>
            </fuse-card>
            <div class="flex flex-grow-0 flex-col">
                <rsa-description-card
                    [descriptions]="prodInfoDescriptions"
                    [labelClasses]="'min-w-40'"
                    [showColon]="true"
                    [embedded]="true"
                    [maxRows]="2"
                    [image]="'rsa:product-plasma'"
                ></rsa-description-card>
            </div>

            <fuse-card class="flex w-full flex-auto flex-col space-y-2">
                <rsa-enter-unit-number-product-code
                    #productSelection
                    (unitNumberProductCodeSelected)="
                        unitNumberProductCodeSelected($event)
                    "
                ></rsa-enter-unit-number-product-code>

                <fuse-card class="m-8 flex-col pb-4">
                    <div class="fuse-card-title">
                        <div
                            class="flex w-full flex-row items-center justify-between px-5"
                        >
                            <h3>Filled Products</h3>
                        </div>
                    </div>
                    <mat-divider></mat-divider>

                    <div class="table-wrapper">
                        <p-table
                            #productTable
                            id="prodTableId"
                            dataKey="id"
                            styleClass="p-datatable-customers p-datatable-sm"
                            [value]="filledProductsData"
                            [loading]="loading"
                        >
                            <ng-template pTemplate="header">
                                <tr>
                                    <th class="w-8"></th>
                                    <th>
                                        <div
                                            class="p-d-flex p-jc-between p-ai-center"
                                        >
                                            Unit Number
                                        </div>
                                    </th>
                                    <th>
                                        <div
                                            class="p-d-flex p-jc-between p-ai-center"
                                        >
                                            Product Code
                                        </div>
                                    </th>
                                    <th>
                                        <div
                                            class="p-d-flex p-jc-between p-ai-center"
                                        >
                                            Description
                                        </div>
                                    </th>
                                    <th>
                                        <div
                                            class="p-d-flex p-jc-between p-ai-center"
                                        >
                                            Visual Inspection
                                        </div>
                                    </th>
                                    <th></th>
                                </tr>
                            </ng-template>
                            <ng-template
                                pTemplate="body"
                                let-product
                                let-i="rowIndex"
                            >
                                <tr>
                                    <td></td>
                                    <td>
                                        {{ product?.unitNumber }}
                                    </td>
                                    <td>
                                        {{ product?.productCode }}
                                    </td>
                                    <td>
                                        {{ product?.productDescription }}
                                    </td>
                                    <td>
                                        {{ product?.visualInspection }}
                                    </td>
                                </tr>
                            </ng-template>
                            <ng-template pTemplate="footer">
                                <tr>
                                    <td class="p-text-right" [attr.colspan]="6">
                                        <span class="ml-6"
                                            >({{ filledProductsData.length }})
                                            Total Products</span
                                        >
                                    </td>
                                </tr>
                            </ng-template>
                        </p-table>
                    </div>
                </fuse-card>
            </fuse-card>
        </div>
        <div class="flex w-3/12 flex-auto flex-col">
            <rsa-order-widget-sidebar
                [orderInput]="{
                    id: shipmentInfo?.orderNumber,
                    priority: shipmentInfo?.priority,
                    labelingProductCategory: shipmentInfo?.productCategory,
                }"
                [comments]="shipmentInfo?.comments"
                [shippingInput]="{
                    id: shipmentInfo?.id,
                    customerCode: shipmentInfo?.shippingCustomerCode,
                    customerName: shipmentInfo?.shippingCustomerName,
                    status: shipmentInfo?.status,
                    method: shipmentInfo?.shippingMethod,
                }"
            />
        </div>
    </div>
</div>

<ng-template #actionButtonsTpl>
    <div class="flex flex-row space-x-2">
        <button
            id="backBtn"
            class="bg-green-highlighted text-white"
            mat-flat-button
            (click)="backToShipmentDetails()"
        >
            Back to Shipment Details
        </button>
    </div>
</ng-template>
