<div class="flex flex-auto flex-col space-y-1">
    <biopro-process-header
        [subTitle]="header.subTitle | async"
        [title]="header.title | async"
        [buttons]="actionButtonsTpl"
    ></biopro-process-header>
    <ng-template #actionButtonsTpl>
        <div class="flex flex-row space-x-2">
            <biopro-action-button
                id="fillMoreProductsBtnId"
                btnId="fillMoreProductsActionBtn"
                label="Fill More Products"
                color="primary"
                icon="heroicons_outline:x-circle"
                [disabled]="
                    shipmentItemsTotalProductsComputed() ===
                    verifiedItemsComputed().length
                "
                (clickEvent)="cancelButtonHandler()"
            />
            <biopro-action-button
                id="completeShipmentBtn"
                btnId="completeActionBtn"
                label="Complete Shipment"
                color="primary"
                icon="heroicons_outline:check-circle"
                [disabled]="
                    !isAllPackItemsVerified() ||
                    toBeRemovedItemsComputed().length > 0
                "
                (clickEvent)="completeShipment()"
            />
        </div>
    </ng-template>

    <biopro-verify-products-navbar
        [links]="{
            Verified: verifyProductsRouteComputed(),
            Notifications: currentRouteComputed(),
        }"
        [activeLinkRoute]="currentRouteComputed()"
        style="margin-top: 1px !important"
    />

    <div class="flex w-full flex-row space-x-8 p-4">
        @if (notificationDetailsSignal(); as verification) {
            <div class="flex w-9/12 flex-auto flex-col space-y-3">
                @if (toBeRemovedItemsComputed()?.length) {
                    <biopro-global-message
                        messageType="error"
                        messageTitle="Notification"
                        [message]="
                            'One or more products have changed status. You must rescan the products to be removed.'
                        "
                    />
                }

                @if (toBeRemovedItemsComputed(); as toBeRemoved) {
                    @if (removedItemsComputed(); as removedItems) {
                        <fuse-card
                            class="flex flex-row items-center space-x-6 p-6"
                        >
                            <div class="flex flex-row space-x-2">
                                <span class="text-left font-bold">
                                    (<span id="filledProductsCount">{{
                                        removedItems.length ?? 0
                                    }}</span>
                                    of
                                    <span id="totalProducts">{{
                                        (toBeRemoved.length ?? 0) +
                                            (removedItems.length ?? 0)
                                    }}</span
                                    >)
                                </span>
                                <span class="text-left font-bold">
                                    Removed Products
                                </span>
                                <span
                                    class="text-left font-bold"
                                    id="percentageId"
                                >
                                    {{ removedItemsPercentage() | percent }}
                                </span>
                            </div>
                            <div class="flex flex-auto flex-col">
                                <biopro-progress-bar
                                    [progressBarId]="
                                        'verifyProductsProgressBarId'
                                    "
                                    [value]="removedItemsPercentage() * 100"
                                />
                            </div>
                        </fuse-card>

                        <fuse-card class="flex w-full flex-col space-y-2">
                            <div class="mt-3">
                                <biopro-scan-unit-number-product-code
                                    #scanUnitNumberProductCode
                                    (validate)="removeItem($event)"
                                />
                            </div>
                        </fuse-card>

                        <fuse-card
                            class="mb-4 flex flex-col px-4 pb-4"
                            id="verifiedProducts-container"
                        >
                            <div
                                class="mb-2 mt-2 flex flex-row justify-between"
                            >
                                <div
                                    class="flex items-center text-lg font-bold"
                                >
                                    <span>
                                        Removed Products (<span
                                            id="numberOfUnitAdded"
                                            >{{ removedItems.length }} /
                                            {{
                                                (toBeRemoved.length ?? 0) +
                                                    (removedItems.length ?? 0)
                                            }}</span
                                        >)
                                    </span>
                                </div>
                            </div>
                            <mat-divider></mat-divider>
                            @if (removedItems.length) {
                                <div
                                    id="optionButtons"
                                    class="grid max-h-[520px] grid-cols-4 gap-4 overflow-auto pb-4 pt-4"
                                >
                                    @for (
                                        removedItem of removedItems;
                                        track $index
                                    ) {
                                        <biopro-unit-number-card
                                            [id]="'unit-' + $index"
                                            class="max-h-24"
                                            [unitNumber]="
                                                removedItem.unitNumber
                                            "
                                            [productName]="
                                                removedItem.productCode
                                            "
                                            [iconName]="
                                                getItemIcon(removedItem)
                                            "
                                            [showVisualInspection]="false"
                                            [ineligibleStatus]="
                                                removedItem.ineligibleStatus
                                            "
                                        />
                                    }
                                </div>
                            }
                        </fuse-card>
                    }
                }
            </div>
        }

        <div class="flex w-1/4 flex-auto flex-col">
            @if (shipmentSignal(); as shipment) {
                <app-order-widget-sidebar
                    [orderInput]="{
                        id: shipment?.orderNumber,
                        priority: shipment?.priority,
                        externalId: shipment?.externalId,
                        labelingProductCategory: shipment?.productCategory,
                    }"
                    [comments]="shipment?.comments"
                    [shippingInput]="{
                        id: shipment?.id,
                        customerCode: shipment?.shippingCustomerCode,
                        customerName: shipment?.shippingCustomerName,
                        status: shipment?.status,
                        method: shipment?.shippingMethod,
                    }"
                />
            }
        </div>
    </div>
</div>
