<rsa-common-modal-template
  [title]="'patient-search.label' | translate"
  [cancelTitle]="'cancel.label'"
  [acceptTitle]="'save.label' | translate"
  (acceptSelection)="save()"
  [displayCloseButton]="false"
  [isValid]="selectedPatient"
>
  <div class="flex">
    <!-- Patient Search Form -->
    <div class="w-full p-4">
      <form [formGroup]="patientSearch" class="mt-3" #patientSearchForm="ngForm">
        <div class="flex flex-row space-x-8">
          <div class="flex flex-col flex-auto space-y-1">
            <div class="flex flex-col items-start">
              <mat-form-field appearance="fill" class="block w-full" rsaControlErrorContainer>
                <mat-label>{{ 'first-name.label' | translate }}</mat-label>
                <input
                  id="firstNameInput"
                  required
                  matInput
                  autocomplete="off"
                  formControlName="firstName"
                  validateOn="blur"
                  [maxLength]="FIRST_NAME_MAX_LENGTH"
                  [customErrors]="{
                    required: 'first-name.label' | validation: validationType.REQUIRED
                  }"
                />
              </mat-form-field>
            </div>
          </div>

          <div class="flex flex-col flex-auto space-y-1">
            <div class="flex flex-col items-start">
              <mat-form-field appearance="fill" class="block w-full" rsaControlErrorContainer>
                <mat-label>{{ 'last-name.label' | translate }}</mat-label>
                <input
                  id="lastNameInput"
                  required
                  matInput
                  autocomplete="off"
                  formControlName="lastName"
                  validateOn="blur"
                  [maxLength]="LAST_NAME_MAX_LENGTH"
                  [customErrors]="{
                    required: 'last-name.label' | validation: validationType.REQUIRED
                  }"
                />
              </mat-form-field>
            </div>
          </div>

          <div class="flex flex-col flex-auto space-y-1">
            <div class="flex flex-col items-start">
              <mat-form-field appearance="fill" class="block w-full">
                <mat-label>{{ 'date-of-birth.label' | translate }}</mat-label>
                <input
                  id="dobInput"
                  required
                  matInput
                  autocomplete="off"
                  formControlName="dob"
                  rsaNoControlErrors
                  [max]="today"
                  [matDatepicker]="dob"
                />
                <mat-datepicker-toggle matSuffix [for]="dob"></mat-datepicker-toggle>
                <mat-datepicker #dob></mat-datepicker>
              </mat-form-field>
              <rsa-control-error
                [hide]="!patientSearch.controls.dob.touched || !patientSearch.controls.dob.errors"
                [text]="dobErrorMessage"
              ></rsa-control-error>
            </div>
          </div>

          <div class="flex flex-auto items-center">
            <button class="bg-success" mat-stroked-button (click)="searchPatient()" [disabled]="!patientSearch.valid">
              {{ 'search.label' | translate }}
            </button>
          </div>
        </div>
      </form>

      <div class="flex flex-col flex-auto space-y-1">
        <div class="table-wrapper">
          <p class="text-custom-red" *ngIf="newPatient">
            {{ 'patient-record-does-not-match-patient-records-in-the-system.label' | translate }}
          </p>
          <!-- PATIENT LIST -->
          <p-table
            *ngIf="patients.length"
            id="patientTableId"
            dataKey="id"
            styleClass="p-datatable-customers p-datatable-sm"
            [value]="patients"
            [paginator]="false"
            [loading]="loading"
          >
            <ng-template pTemplate="header">
              <tr>
                <th>
                  <div class="p-d-flex p-jc-between p-ai-center">
                    {{ 'first-name.label' | translate }}
                  </div>
                </th>
                <th>
                  <div class="p-d-flex p-jc-between p-ai-center">
                    {{ 'last-name.label' | translate }}
                  </div>
                </th>
                <th>
                  <div class="p-d-flex p-jc-between p-ai-center">
                    {{ 'date-of-birth.label' | translate }}
                  </div>
                </th>
                <th *ngIf="newPatient"></th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-patient>
              <tr>
                <td>{{ patient.firstName }}</td>
                <td>{{ patient.lastName }}</td>
                <td>{{ patient.dob | date: 'MM/dd/yyyy' }}</td>
                <td *ngIf="newPatient" class="text-right">
                  <button class="btn-info" mat-stroked-button (click)="removePatient(patient.id)">
                    {{ 'remove.label' | translate }}
                  </button>
                </td>
              </tr>
            </ng-template>
          </p-table>
        </div>
      </div>
    </div>
  </div>
</rsa-common-modal-template>
