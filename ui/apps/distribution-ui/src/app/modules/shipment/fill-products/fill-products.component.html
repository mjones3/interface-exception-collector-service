<div class="flex flex-col flex-auto space-y-1">
  <rsa-process-header
    [subTitle]="header.subTitle$ | async | translate"
    [title]="header.title$ | async | translate"
    [buttons]="actionButtonsTpl"
  ></rsa-process-header>

  <div class="w-full flex flex-row space-x-8 p-4">
    <div class="flex flex-col flex-auto space-y-3 w-9/12">
      <treo-card class="flex flex-row space-x-6 items-center p-6">
        <div class="flex flex-row space-x-2">
          <span class="text-left font-bold">{{ 'quantity.label' | translate }}:</span>
          <span class="text-left font-bold">
            <span
              >( <span id="filledProductsCountId">{{ filledProductsData?.length }} </span> {{ 'of.label' | translate }}
              <span id="prodQtyId">{{ quantity }}</span
              >)</span
            >
          </span>
        </div>
        <div class="flex flex-col flex-auto">
          <mat-progress-bar
            id="productsFilledProgressBar"
            class="h-2"
            mode="determinate"
            [value]="((filledProductsData?.length || 0) / quantity) * 100"
          ></mat-progress-bar>
        </div>
      </treo-card>
      <div class="flex flex-col flex-grow-0">
        <rsa-description-card
          [descriptions]="prodInfoDescriptions"
          [labelClasses]="'min-w-40'"
          [showColon]="true"
          [embedded]="true"
          [maxRows]="2"
          [image]="prodIcon"
        ></rsa-description-card>
      </div>

      <treo-card class="flex flex-col space-y-2 flex-auto">
        <rsa-enter-unit-number-product-code
          #productSelection
          (unitNumberProductCodeSelected)="unitNumberProductCodeSelected($event)"
        ></rsa-enter-unit-number-product-code>

        <treo-card class="flex-col m-8 pb-4">
          <div class="treo-card-title">
            <div class="flex flex-row w-full justify-between items-center px-5">
              <h3>{{ 'filled-products.label' | translate }}</h3>
            </div>
          </div>
          <mat-divider></mat-divider>

          <div class="table-wrapper">
            <p-table
              #productTable
              id="prodTableId"
              dataKey="id"
              styleClass="p-datatable-customers p-datatable-sm"
              [value]="filledProductsData"
              [loading]="loading"
            >
              <ng-template pTemplate="header">
                <tr>
                  <th class="w-8"></th>
                  <th>
                    <div class="p-d-flex p-jc-between p-ai-center">
                      {{ 'unit-number.label' | translate }}
                    </div>
                  </th>
                  <th>
                    <div class="p-d-flex p-jc-between p-ai-center">
                      {{ 'product-code.label' | translate }}
                    </div>
                  </th>
                  <th>
                    <div class="p-d-flex p-jc-between p-ai-center">
                      {{ 'description.label' | translate }}
                    </div>
                  </th>
                  <th>
                    <div class="p-d-flex p-jc-between p-ai-center">
                      {{ 'visual-inspection.label' | translate }}
                    </div>
                  </th>
                  <th></th>
                </tr>
              </ng-template>
              <ng-template pTemplate="body" let-product let-i="rowIndex">
                <tr>
                  <td></td>
                  <td>
                    {{ product?.unitNumber }}
                  </td>
                  <td>
                    {{ product?.productCode }}
                  </td>
                  <td>
                    {{ product?.productDescription | translate }}
                  </td>
                  <td>
                    {{ product?.visualInspection | translate }}
                  </td>
                </tr>
              </ng-template>
              <ng-template pTemplate="footer">
                <tr>
                  <td class="p-text-right" [attr.colspan]="6">
                    <span class="ml-6">({{ filledProductsData.length }}) {{ 'total-products.label' | translate }}</span>
                  </td>
                </tr>
              </ng-template>
            </p-table>
          </div>
        </treo-card>
      </treo-card>
    </div>
    <div class="flex flex-col flex-auto w-3/12">
      <rsa-order-widget-sidebar
        [orderInfoDescriptions]="orderInfoDescriptions"
        [shippingInfoDescriptions]="shippingInfoDescriptions"
      ></rsa-order-widget-sidebar>
    </div>
  </div>
</div>

<ng-template #actionButtonsTpl>
  <div class="flex flex-row space-x-2">
    <button id="saveBtn" class="primary" mat-stroked-button (click)="backToShipmentDetails()">
      {{ 'back-to-shipment-details.label' | translate }}
    </button>
  </div>
</ng-template>
