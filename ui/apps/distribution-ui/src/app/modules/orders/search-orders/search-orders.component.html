<div class="flex flex-col flex-auto">
  <rsa-process-header
    [buttons]=""
    [subTitle]="header.subTitle$ | async | translate"
    [title]="header.title$ | async | translate"
  ></rsa-process-header>
  <div class="flex flex-col">
    <div class="flex flex-row space-x-4 w-full p-4">
      <div class="w-full overflow-hidden">
        <treo-card class="flex-col pb-4">
          <!-- Header Section -->
          <div class="treo-card-title">
            <div class="flex flex-row w-full justify-between px-5 items-baseline">
              <h3>{{ 'results.label' | translate }}</h3>
            </div>
          </div>
          <mat-divider></mat-divider>
          <div class="table-wrapper">
            <p-table
              #orderTable
              id="ordersTableId"
              dataKey="id"
              styleClass="p-datatable-customers p-datatable-sm"
              currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
              [value]="orders"
              [columns]="selectedColumns"
              [rows]="defaultRowsPerPage"
              [totalRecords]="totalRecords"
              [rowsPerPageOptions]="[10, 25, 50]"
              [showCurrentPageReport]="true"
              [paginator]="false"
              [loading]="loading"
              [lazy]="true"
              [sortField]="defaultSortField"
              [expandedRowKeys]="expandedRows"
              (onLazyLoad)="fetchOrders($event)"
              >
              <ng-template pTemplate="header" let-columns>
                <tr>
                  <th class="w-12">
                  </th>
                  <th
                    [pSortableColumn]="col.sortable ? (col.sortFieldName ? col.sortFieldName : col.field) : null"
                    [ngClass]="col.headerCls"
                    *ngFor="let col of columns; let i = index"
                  >
                    <div class="flex items-center p-d-flex p-jc-between p-ai-center" *ngIf="!col.hideHeader">
                      {{ col.header | translate }}
                      <p-sortIcon
                        [field]="col.sortFieldName ? col.sortFieldName : col.field"
                        *ngIf="col.sortable"
                      ></p-sortIcon>
                    </div>
                  </th>
                </tr>
              </ng-template>
              <ng-template pTemplate="body" let-order let-expanded="expanded" let-columns="columns">
                <tr>
                  <td [ngStyle]="{ width: '30px' }">
                    <button
                      id="expandRowBtn"
                      type="button"
                      class="p-button-text p-button-rounded p-button-plain"
                      pButton
                      pRipple
                      *ngIf="order?.comments"
                      [pRowToggler]="order"
                      [icon]="expanded ? 'pi pi-chevron-down' : 'pi pi-chevron-right'"
                    ></button>
                  </td>
                  <td *ngFor="let col of columns; let i = index" class="break-all">
                    <ng-template #dateTpl let-order let-field="field">
                      {{ order[field] | date: 'MM/dd/yyyy' }}
                    </ng-template>
                    <ng-template #actionTpl let-order>
                      <button
                        id="detailsBtn"
                        class="bg-custom-red justify-center"
                        mat-stroked-button
                        (click)="details(order)"
                      >
                        {{ 'details.label' | translate }}
                      </button>
                    </ng-template>
                    <ng-template #statusTpl let-order>
                      <span class="badge status" [ngStyle]="{ 'background-color': order.statusColor }">
                        {{ order.statusDescriptionKey | translate | uppercase }}
                      </span>
                    </ng-template>

                    <ng-container *ngIf="{ dateTpl: dateTpl, statusTpl: statusTpl, actionTpl: actionTpl } as templates">
                      <ng-container *ngIf="col?.templateRef">
                        <ng-container
                          *ngTemplateOutlet="
                            templates[col?.templateRef];
                            context: { $implicit: order, field: col?.field }
                          "
                        ></ng-container>
                      </ng-container>
                    </ng-container>

                    <ng-container *ngIf="!col?.templateRef">
                      {{ order[col.field]?.toString() | translate | uppercase }}
                    </ng-container>
                  </td>
                </tr>
              </ng-template>
              <ng-template pTemplate="rowexpansion" let-order>
                <tr>
                  <td [attr.colspan]="selectedColumns?.length">
                    <div class="p-4">
                      <span class="font-bold mb-1 text-left mr-4 w-60">{{ 'comments.label' | translate }}</span>
                      <span class="flex-auto text-left">{{ order?.comments | uppercase }}</span>
                    </div>
                  </td>
                </tr>
              </ng-template>
            </p-table>
          </div>
        </treo-card>
      </div>
    </div>
  </div>
</div>
