<div class="flex flex-col flex-auto space-y-1">
  <rsa-process-header
    [subTitle]="header.subTitle$ | async | translate"
    [title]="header.title$ | async | translate"
    [buttons]="actionButtonsTpl"
  ></rsa-process-header>

  <div class="w-full flex flex-row space-x-8 p-4">
    <div class="flex flex-col flex-auto space-y-3 w-9/12">
      <treo-card class="flex flex-row space-x-6 items-center p-6">
        <div class="flex flex-row w-60 space-x-2">
          <span class="text-left font-bold">{{
            '(' + validatedProducts + ' ' + ('of.label' | translate) + ' ' + totalProducts + ')'
          }}</span>
          <span class="text-left font-bold">{{ 'validated-products.label' | translate }}:</span>
        </div>
        <div class="flex flex-col flex-auto">
          <mat-progress-bar
            id="validateProductsProgressBar"
            class="h-2"
            mode="determinate"
            [value]="((validatedProducts || 0) / totalProducts) * 100"
          ></mat-progress-bar>
        </div>
      </treo-card>
      <div class="flex flex-row-reverse">
        <button
          id="completeBtnId"
          class="primary"
          [disabled]="validatedProducts === 0 || failedProducts"
          mat-stroked-button
          (click)="completeOrder()"
        >
          {{ 'complete.label' | translate }}
        </button>
      </div>

      <treo-card class="flex flex-col space-y-2 flex-auto">
        <div class="treo-card-title">
          <div class="flex flex-row w-full justify-between items-center px-5">
            <h3>{{ 'validate-order-shipment.label' | translate }}</h3>
          </div>
        </div>
        <mat-divider></mat-divider>
        <rsa-product-selection
          [currentOrder]="currentOrder"
          (unitNumberProductCodeSelected)="unitNumberProductCodeSelected($event.unitNumber, $event.productCode)"
          (updateLoadingState)="updateLoadingState($event)"
          [selectedInventoryIds]="getValidatedInventoryIds"
          #productSelectionComponent
        ></rsa-product-selection>

        <treo-card class="flex-col m-8 pb-4">
          <div class="table-wrapper">
            <p-table
              id="prodTableId"
              [value]="products"
              dataKey="id"
              [rows]="10"
              [showCurrentPageReport]="true"
              [rowsPerPageOptions]="[10, 25, 50]"
              [loading]="loading"
              styleClass="p-datatable-customers p-datatable-sm"
              [paginator]="true"
              currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
            >
              <ng-template pTemplate="header">
                <tr>
                  <th class="w-40">
                    <div class="p-d-flex ml-4 p-jc-between p-ai-center">
                      {{ 'validated.label' | translate }}
                    </div>
                  </th>
                  <th>
                    <div class="p-d-flex p-jc-between p-ai-center">
                      {{ 'unit-number.label' | translate }}
                    </div>
                  </th>
                  <th>
                    <div class="p-d-flex p-jc-between p-ai-center">
                      {{ 'product-code.label' | translate }}
                    </div>
                  </th>
                </tr>
              </ng-template>
              <ng-template pTemplate="body" let-product let-i="rowIndex">
                <tr>
                  <td>
                    <div
                      class="flex flex-row justify-center"
                      *ngIf="product?.validated !== undefined"
                      [ngClass]="{
                        'text-custom-red': !product?.validated && product?.validated !== undefined,
                        'text-custom-green': product?.validated
                      }"
                    >
                      <mat-icon [svgIcon]="product?.validated ? 'check_circle' : 'hi_outline:x-circle'"></mat-icon>
                    </div>
                  </td>
                  <td>
                    <div
                      [ngClass]="{
                        'text-custom-red': !product?.validated && product?.validated !== undefined,
                        'text-custom-green': product?.validated
                      }"
                    >
                      {{ product?.unitNumber }}
                    </div>
                  </td>
                  <td>
                    <div
                      [ngClass]="{
                        'text-custom-red': !product?.validated && product?.validated !== undefined,
                        'text-custom-green': product?.validated
                      }"
                    >
                      {{ product?.productCode }}
                    </div>
                  </td>
                </tr>
              </ng-template>
            </p-table>
          </div>
        </treo-card>
      </treo-card>
    </div>
    <div class="flex flex-col flex-auto w-3/12">
      <rsa-order-widget-sidebar
        [feesInfoDescriptions]="feesInfoDescriptions"
        [billInfoDescriptions]="billInfoDescriptions"
        [orderInfoDescriptions]="orderInfoDescriptions"
        [shippingInfoDescriptions]="shippingInfoDescriptions"
        [comments]="currentOrder?.comments"
      >
      </rsa-order-widget-sidebar>
    </div>
  </div>
</div>

<ng-template #actionButtonsTpl>
  <div class="flex flex-row space-x-2">
    <button id="backBtnId" class="primary" mat-stroked-button (click)="back()">
      {{ 'back.label' | translate }}
    </button>
  </div>
</ng-template>
