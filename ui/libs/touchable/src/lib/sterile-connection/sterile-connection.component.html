<div class="w-full h-full">
  <div class="flex-auto h-full">
    <!-- Dynamic Information Section -->
    <div id="dynamicInfoSection" class="mb-4">
      <ng-content></ng-content>
    </div>

    <!-- Stepper Content -->
    <treo-card>
      <mat-horizontal-stepper
        [selectedIndex]="sterileConnectionCompleted ? 1 : 0"
        [linear]="true"
        #sterileConnectionStepper
        class="bg-transparent w-full p-0"
      >
        <!-- Step 1 - Sterile Connection -->
        <mat-step>
          <form [formGroup]="sterileConnectionForm">
            <div class="w-full">
              <!-- Step Header Section -->
              <div class="treo-card-title">
                <h3>{{ 'select-values.label' | translate }}</h3>
              </div>
              <mat-divider></mat-divider>

              <!-- Step 1 Content Section -->
              <div mat-card-content class="p-8 max-w-180">
                <!-- Sterile Connection Process -->
                <div class="flex flex-col gt-xs:flex-row gt-xs:items-baseline gt-xs:mb-4">
                  <ng-container *ngIf="definedProcess">
                    <label class="field-label mr-4 font-bold min-w-60">
                      {{ 'sterile-connection-process.label' | translate }}
                    </label>
                    <span>{{ definedProcess | translate }}</span>
                  </ng-container>

                  <ng-container *ngIf="!definedProcess">
                    <rsa-select-options-picker
                      [selectId]="'sterileProcessSelect'"
                      [options]="sterileConnectionProcess"
                      [optionsLabel]="'descriptionKey'"
                      [dialogTitle]="'sterile-connection-process.label'"
                      [placeholder]="'select-sterile-connection-process.placeholder'"
                      [labelTitle]="'sterile-connection-process.label'"
                      formControlName="scp"
                      labelClasses="min-w-60"
                      rsaNoControlErrors
                      [customErrors]="{
                        required: 'sterile-connection-process.label' | validation: validationType.REQUIRED
                      }"
                      [selectClasses]="'min-w-100'"
                    ></rsa-select-options-picker>
                  </ng-container>
                </div>

                <!-- SCD Serial Number -->
                <div class="flex flex-col gt-xs:flex-row gt-xs:items-baseline gt-xs:mb-4">
                  <rsa-select-options-picker
                    [selectId]="'scdSerialNumbSelect'"
                    [dialogTitle]="'scd-serial-number.label'"
                    [labelTitle]="'scd-serial-number.label'"
                    [placeholder]="'select-scd-serial-number.placeholder'"
                    [options]="scdSerialNumber"
                    [optionsLabel]="'lotNumber'"
                    formControlName="scdsn"
                    labelClasses="min-w-60"
                    rsaNoControlErrors
                    [customErrors]="{ required: 'scd-serial-number.label' | validation: validationType.REQUIRED }"
                    [selectClasses]="'min-w-100'"
                  ></rsa-select-options-picker>
                </div>

                <!-- SCD Wafer Lot Number -->
                <div class="flex flex-col gt-xs:flex-row gt-xs:items-baseline gt-xs:mb-4">
                  <rsa-select-options-picker
                    [selectId]="'scdWaferLotNumber'"
                    [options]="scdWaferLotNumber"
                    [optionsLabel]="'lotNumber'"
                    [dialogTitle]="'scd-wafer-lot-number.label'"
                    [labelTitle]="'scd-wafer-lot-number.label'"
                    [placeholder]="'select-scd-wafer-lot-number.placeholder'"
                    formControlName="scdwln"
                    labelClasses="min-w-60"
                    rsaNoControlErrors
                    [customErrors]="{ required: 'scd-wafer-lot-number.label' | validation: validationType.REQUIRED }"
                    [selectClasses]="'min-w-100'"
                  ></rsa-select-options-picker>
                </div>

                <!-- Current Container Lot Number -->
                <div class="flex flex-col gt-xs:flex-row gt-xs:items-baseline gt-xs:mb-4">
                  <div class="flex flex-row items-baseline">
                    <label class="mr-4 font-bold min-w-60">{{
                      'current-container-lot-number.label' | translate
                    }}</label>
                    <div class="flex flex-col">
                      <rsa-input-keyboard
                        class="w-full"
                        [className]="'min-w-100'"
                        [inputId]="'currentContLotNumbInput'"
                        formControlName="ccln"
                        labelClasses="w-60"
                        [customErrors]="{
                          required: 'current-container-lot-number.label' | validation: validationType.REQUIRED
                        }"
                        [inputWidth]="'w-full'"
                      ></rsa-input-keyboard>
                    </div>
                  </div>
                </div>

                <!-- Transfer Container Lot Number -->
                <div class="flex flex-col gt-xs:flex-row gt-xs:items-baseline gt-xs:mb-4">
                  <rsa-select-options-picker
                    [selectId]="'transContLotNumbSelect'"
                    [options]="transferContainerLotNumber"
                    [optionsLabel]="'lotNumber'"
                    [dialogTitle]="'transfer-container-lot-number.label'"
                    [labelTitle]="'transfer-container-lot-number.label'"
                    [placeholder]="'select-transfer-container-lot-number.placeholder'"
                    formControlName="tcln"
                    labelClasses="min-w-60"
                    rsaNoControlErrors
                    [customErrors]="{
                      required: 'transfer-container-lot-number.label' | validation: validationType.REQUIRED
                    }"
                    [selectClasses]="'min-w-100'"
                  ></rsa-select-options-picker>
                </div>
              </div>
            </div>
          </form>
        </mat-step>

        <!-- Step 2 - Weld & Inspection -->
        <mat-step>
          <form [formGroup]="weldInspectionForm">
            <div class="w-full">
              <!-- Step Header Section -->
              <div class="treo-card-title">
                <h3>{{ 'weld-inspection-title.label' | translate }}</h3>
              </div>
              <mat-divider></mat-divider>

              <!-- Step Content Section -->
              <div mat-card-content class="p-8 grid gap-2">
                <!-- Weld Inspection Fields -->
                <div class="flex flex-col gt-xs:flex-row gt-xs:items-baseline mb-4">
                  <span class="font-semibold mb-1 gt-xs:text-left gt-xs:min-w-60 gt-xs:mr-4 gt-xs:mb-0 font-bold">
                    {{ 'weld-inspection.label' | translate }}
                  </span>

                  <mat-button-toggle-group
                    appearance="legacy"
                    id="inspectionRadioGroup"
                    formControlName="inspection"
                    aria-label="Weld Inspection"
                  >
                    <mat-button-toggle id="satisfactoryRadio" [value]="true">{{
                      'satisfactory.label' | translate | titlecase
                    }}</mat-button-toggle>
                    <mat-button-toggle id="unsatisfactoryRadio" [value]="false">{{
                      'unsatisfactory.label' | translate | titlecase
                    }}</mat-button-toggle>
                  </mat-button-toggle-group>
                </div>

                <!-- Fields for Satisfactory Weld Inspection (Dynamic Fields) -->
                <div
                  [formGroupName]="'satisfactory'"
                  *ngIf="isWeldInspectionSatisfactory && satisfactoryFields.length > 0"
                  class="flex flex-wrap"
                >
                  <div class="flex-1">
                    <div
                      class="flex gt-xs:items-baseline mb-4"
                      *ngFor="let field of satisfactoryFieldsColumns1; let index = index"
                    >
                      <label class="mr-4 font-bold w-60 min-w-60">{{ field.descriptionKey | translate }}</label>
                      <div class="flex flex-col">
                        <div *ngIf="this.visualInspection && field.formControl === 'visualInspection'; else inputField">
                          <mat-button-toggle-group
                            appearance="legacy"
                            id="visualInspectionKey"
                            formControlName="visualInspection"
                          >
                            <mat-button-toggle id="satisfactoryVIRadio" [value]="true">{{
                              'satisfactory.label' | translate | titlecase
                            }}</mat-button-toggle>
                            <mat-button-toggle id="unsatisfactoryVIRadio" [value]="false">{{
                              'unsatisfactory.label' | translate | titlecase
                            }}</mat-button-toggle>
                          </mat-button-toggle-group>
                        </div>
                        <ng-template #inputField>
                          <rsa-input-keyboard
                            [inputId]="field.formControl + 'Input'"
                            [formControlName]="field.formControl"
                            [inputWidth]="'max-w-80'"
                            [iconName]="field.iconName"
                            [customErrors]="{
                              required: field.descriptionKey | validation: validationType.REQUIRED,
                              pattern: field.errorKey | translate
                            }"
                            validateOn="blur"
                            (tabOrEnterPressed)="onTabOrEnter($event, field.formControl)"
                            (blur)="onTabOrEnter($event, field.formControl)"
                          >
                          </rsa-input-keyboard>
                        </ng-template>
                      </div>
                    </div>
                  </div>

                  <div class="flex-1" *ngIf="satisfactoryFieldsColumns2.length > 0">
                    <div
                      class="flex gt-xs:items-baseline mb-4"
                      *ngFor="let field of satisfactoryFieldsColumns2; let index = index"
                    >
                      <label class="mr-4 font-bold w-60 min-w-60">{{ field.descriptionKey | translate }}</label>
                      <div class="flex flex-col">
                        <rsa-input-keyboard
                          [inputId]="field.formControl + 'Input'"
                          [formControlName]="field.formControl"
                          [inputWidth]="'max-w-80'"
                          [iconName]="field.iconName"
                          [customErrors]="{
                            required: field.descriptionKey | validation: validationType.REQUIRED,
                            pattern: field.errorKey | translate
                          }"
                          validateOn="blur"
                          (tabOrEnterPressed)="onTabOrEnter($event, field.formControl)"
                          (blur)="onTabOrEnter($event, field.formControl)"
                        >
                        </rsa-input-keyboard>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Fields for Unsatisfactory Weld Inspection -->
                <ng-container
                  [formGroupName]="'unsatisfactory'"
                  *ngIf="isWeldInspectionSatisfactory != undefined && !isWeldInspectionSatisfactory"
                  id="reweld-options"
                >
                  <!-- Discard Or Reweld -->
                  <div class="flex flex-col gt-xs:flex-row gt-xs:items-baseline mb-4">
                    <span class="font-bold mb-1 gt-xs:text-left gt-xs:min-w-60 gt-xs:mr-4 gt-xs:mb-0">{{
                      'select-action-taken.label' | translate
                    }}</span>
                    <mat-button-toggle-group
                      appearance="legacy"
                      id="actionTakenRadioGroup"
                      formControlName="actionTaken"
                      aria-label="Select action taken"
                      [(ngModel)]="isReweldActionSelected"
                    >
                      <mat-button-toggle id="reweldRadio" [value]="true">{{
                        'reweld.label' | translate | titlecase
                      }}</mat-button-toggle>
                      <mat-button-toggle id="discardRadio" [value]="false">{{
                        'discard.label' | translate | titlecase
                      }}</mat-button-toggle>
                    </mat-button-toggle-group>
                  </div>
                </ng-container>

                <!-- Comments Field -->
                <div class="flex flex-col gt-xs:flex-row gt-xs:items-baseline">
                  <rsa-input-keyboard
                    [maxLength]="commentsMaxLength"
                    [inputId]="'commentsInput'"
                    [inputType]="inputTypeEnum.TEXTAREA"
                    [labelTitle]="'comments.label'"
                    [labelWidth]="'w-60 min-w-60'"
                    [inputWidth]="'w-100'"
                    formControlName="comments"
                  ></rsa-input-keyboard>
                </div>
              </div>
            </div>
          </form>
        </mat-step>
      </mat-horizontal-stepper>
    </treo-card>
  </div>
</div>
