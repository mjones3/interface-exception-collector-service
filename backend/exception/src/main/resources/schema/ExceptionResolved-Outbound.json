{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://schemas.biopro.arcone.com/events/ExceptionResolved/v1.0.0",
  "title": "Exception Resolved Event",
  "description": "Event published when an exception is fully resolved",
  "type": "object",
  "required": [
    "eventId",
    "eventType", 
    "eventVersion",
    "occurredOn",
    "source",
    "payload"
  ],
  "properties": {
    "eventId": {
      "type": "string",
      "format": "uuid"
    },
    "eventType": {
      "type": "string",
      "const": "ExceptionResolved"
    },
    "eventVersion": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+$"
    },
    "occurredOn": {
      "type": "string",
      "format": "date-time"
    },
    "source": {
      "type": "string",
      "const": "exception-collector-service"
    },
    "correlationId": {
      "type": "string",
      "format": "uuid"
    },
    "payload": {
      "type": "object",
      "required": [
        "exceptionId",
        "transactionId",
        "resolutionMethod"
      ],
      "properties": {
        "exceptionId": {
          "type": "integer",
          "format": "int64"
        },
        "transactionId": {
          "type": "string",
          "format": "uuid"
        },
        "resolutionMethod": {
          "type": "string",
          "enum": ["RETRY_SUCCESS", "MANUAL_RESOLUTION", "CUSTOMER_RESOLVED", "AUTOMATED"],
          "description": "How the exception was resolved"
        },
        "resolvedBy": {
          "type": "string",
          "description": "User or system that resolved the exception"
        },
        "resolvedAt": {
          "type": "string",
          "format": "date-time"
        },
        "totalRetryAttempts": {
          "type": "integer",
          "minimum": 0,
          "description": "Total number of retry attempts made"
        },
        "resolutionTimeHours": {
          "type": "number",
          "description": "Hours from exception capture to resolution"
        },
        "resolutionNotes": {
          "type": "string",
          "description": "Optional notes about the resolution"
        },
        "customerNotified": {
          "type": "boolean",
          "description": "Whether customer was notified of resolution"
        },
        "finalStatus": {
          "type": "string",
          "enum": ["RESOLVED", "CLOSED"],
          "description": "Final status of the exception"
        }
      }
    }
  },
  "examples": [
    {
      "eventId": "550e8400-e29b-41d4-a716-446655440014",
      "eventType": "ExceptionResolved",
      "eventVersion": "1.0",
      "occurredOn": "2025-08-04T14:20:00Z",
      "source": "exception-collector-service",
      "payload": {
        "exceptionId": 12346,
        "transactionId": "550e8400-e29b-41d4-a716-446655440013",
        "resolutionMethod": "RETRY_SUCCESS",
        "resolvedBy": "user123",
        "resolvedAt": "2025-08-04T14:20:00Z",
        "totalRetryAttempts": 1,
        "resolutionTimeHours": 3.5,
        "resolutionNotes": "Successfully retried after customer corrected data",
        "customerNotified": true,
        "finalStatus": "RESOLVED"
      }
    }
  ]
}
